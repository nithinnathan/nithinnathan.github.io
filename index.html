<!DOCTYPE html>
<html>
<head>
  <title>Narrative Visualization with D3, d3-annotation, and topoJSON</title>
  <style>
    /* Add any custom CSS styles here if needed */
    body {
      font-family: Arial, sans-serif;
    }
    .map {
      border: 1px solid #ccc;
    }
    .annotation {
      font-size: 12px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Narrative Visualization Example</h1>
  <div class="map"></div>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/d3-annotation"></script>
  <script src="https://unpkg.com/topojson-client@3.1.0"></script>
  <script>
    // Your JavaScript code for the narrative visualization
    // Replace this with your own data and annotations

    // Sample data - replace this with your own dataset
    const data = [
      { country: 'USA', value: 120 },
      { country: 'Canada', value: 90 },
      { country: 'UK', value: 80 },
      { country: 'Germany', value: 70 },
      { country: 'Japan', value: 50 },
    ];

    // Sample annotations - replace this with your own annotations
    const annotations = [
      { country: 'USA', note: 'Annotation for USA', dx: 50, dy: -50 },
      { country: 'Germany', note: 'Annotation for Germany', dx: 80, dy: 30 },
    ];

    // Width and height of the map container
    const width = 600;
    const height = 400;

    // Create the SVG element for the map
    const svg = d3.select('.map')
      .append('svg')
      .attr('width', width)
      .attr('height', height);

    // Load the map data using topoJSON
    d3.json('world_map.json').then((mapData) => {
      const countries = topojson.feature(mapData, mapData.objects.countries);

      // Create a projection for the map
      const projection = d3.geoMercator().fitSize([width, height], countries);
      const path = d3.geoPath().projection(projection);

      // Draw the map
      svg.selectAll('.country')
        .data(countries.features)
        .enter()
        .append('path')
        .attr('class', 'country')
        .attr('d', path);

      // Add annotations
      const makeAnnotations = d3.annotation()
        .type(d3.annotationLabel)
        .accessors({
          x: d => projection([d.longitude, d.latitude])[0],
          y: d => projection([d.longitude, d.latitude])[1],
        })
        .annotations(annotations);

      svg.append('g')
        .attr('class', 'annotation-group')
        .call(makeAnnotations);
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html>
    <head>
        <title>CS 416: Narrative Visualization - Nithin Nathan</title>
        <meta charset="UTF-8">
        <meta name="description" content="CS 416: Narrative Visualization - Nithin Nathan">
        <meta name="author" content="Nithin Nathan">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="mystyle.css">
        <script src="https://d3js.org/d3.v4.min.js"></script>
    </head>
    <body>
        <h1 align="center">U.S. Gun Violence (1980s-2020s)</h1>
        <p align="left">The United States is the home of the highest rate of gun ownership worldwide due to safeguarding by the Second Amendment to the U.S. Constitution.<br>
            Individuals with firearms find usage through various activities, such as self-defense, hunting, and target shooting.<br>
            Although there are several harmless use cases for firearms, there are many harmful ones as well, and in this narrative visualization you will be able to explore some other statistics that demonstrate the violence caused by individuals who own a firearm in America.<br>
        </p>
        <!-- <p align="left">Source:<a href='https://www.kaggle.com/datasets/nidzsharma/us-mass-shootings-19822023' class="link" target="_blank" rel="noreferrer noopener"> https://www.kaggle.com/datasets/nidzsharma/us-mass-shootings-19822023</a></p> -->
        
        <div align="left">
            <p>The buttons below will help you explore and understand these metrics.</p>
            <a href="index.html" class="other">Home</a>
            <a href="about.html" class="other">About</a>
            <a href="#" class="current">Fatalities</a>
            <a href="injured.html" class="other">Injured</a>
            <a href="total_victims.html" class="other">Total Victims</a>
            <a href="conclusion.html" class="other">Conclusion</a>
        </div>

        <h3>Fatalities Over Time</h3>
        <p>This line chart shows the sum of fatalities over time.</p>
            
        <div id="fatalities"></div>
        <div id="tooltip"></div>
        <script>

            // set the dimensions and margins of the graph
            var margin = {top: 10, right: 30, bottom: 30, left: 120},
                width = 660 - margin.left - margin.right,
                height = 660 - margin.top - margin.bottom;

            // append the svg object to the body of the page
            var svg = d3.select("#fatalities")
            .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
            .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            //Read the data
            d3.csv("https://raw.githubusercontent.com/nithinnathan/nithinnathan.github.io/master/fatalities.csv", function(data) {

                // group the data: I want to draw one line per group
                var sumstat = d3.nest() // nest function allows to group the calculation per level of a factor
                    .key(function(d) { return d.Location; })
                    .entries(data);
                //console.log(sumstat);

                // Add X axis --> it is a date format
                var x = d3.scaleLinear()
                    .domain(d3.extent(data, function(d) { return d.Year; }))
                    .range([0,width]);

                svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x).ticks(10).tickFormat(d3.format("d")));

                // Add Y axis
                var y = d3.scaleLinear()
                    .domain([0,d3.max(data, function(d) { return +d.Fatalities; })])
                    .range([height,0]);
                    
                svg.append("g")
                    .call(d3.axisLeft(y).ticks(10));
                        
                // color palette
                var res = sumstat.map(function(d){ return d.key }) // list of group names
                //console.log(res);
                var color = d3.scaleOrdinal()
                    .domain(res)
                    .range(['#999999'])

                var tooltip = d3.select("body").append("div").attr("class", "toolTip");
                //console.log(tooltip);

                //Draw the line
                svg.selectAll(".line")
                    .data(sumstat)
                    .enter()
                    .append("path")
                        .attr("fill", "none")
                        .attr("stroke", "darkblue")
                        .attr("stroke-dasharray", function(d,i) { return i; })
                        .attr("stroke-width", 2.5)
                        .attr("d", function(d){
                        return d3.line()
                            .x(function(d) { return x(d.Year); })
                            .y(function(d) { return y(+d.Fatalities); })
                            (d.values)
                        })
                    .on("mouseover", function (d,i) {
                        tooltip.style("left", d3.event.pageX - 50 + "px")
                        .style("top", d3.event.pageY - 70 + "px")
                        .style("display", "inline-block")
                        .style("font-family", "Helvetica")
                        .style("font-size", "70%")
                        .html("Sum of Fatalities: 1101");
                        })
                    .on("mouseout", function (d) { tooltip.style("display", "none"); });
                        
                // //Legend
                // const colDict = {United_States: '#ff7f00'}
                // var legend_keys = ["United_States"]

                //     var lineLegend = svg.selectAll(".lineLegend").data(legend_keys)
                //         .enter().append("g")
                //         .attr("class","lineLegend")
                //         .attr("transform", function (d,i) {
                //                 return "translate(" + width + "," + (i*20)+")";
                //             });

                //     lineLegend.append("text").text(function (d) {return d;})
                //         .attr("transform", "translate(-200,250)"); //align texts with boxes

                //     lineLegend.append("rect")
                //         //.attr("fill", function (d) {return color(d.key); })
                //         .attr("fill", d => colDict[d])
                //         .attr("transform", "translate(-220,240)")
                //         .attr("width", 10).attr("height", 10);
            })
        </script>
    </body>
</html>
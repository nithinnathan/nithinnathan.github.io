<!DOCTYPE html>
<html>
    <head>
        <title>CS 416: Narrative Visualization - Nithin Nathan</title>
        <meta charset="UTF-8">
        <meta name="description" content="CS 416: Narrative Visualization - Nithin Nathan">
        <meta name="author" content="Nithin Nathan">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="mystyle.css">
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-annotation/2.5.1/d3-annotation.min.js"></script>
    </head>
    <body>
        
        <h1 align="center">U.S. Gun Violence (1980s-2020s)</h1>
        
        <div align="center">
            <p>The buttons below will help you explore and understand these metrics.</p>
            <a href="index.html" class="other">About</a>
            <a href="fatalities.html" class="other">Fatalities</a>
            <a href="injured.html" class="other">Injured</a>
            <a href="#" class="current">Total Victims</a>
        </div>

        <h3>Total Victims Over Time</h3>
        <p>
            An injury is defined as <i>"a person harmed, injured, or killed as a result of a crime, accident, or other event or action"</i>.<br>
            In the case of gun violence, a victim is any individual that has been affected by gun-related events (both passed away and injuries).<br>
            This line chart shows the sum of total victims over time.<br>
        </p>

        <div id="total_victims"></div>
        <div id="tooltip"></div>
        <script>
            var margin = {top: 0, right: 30, bottom: 30, left: 30},
                width = 660 - margin.left - margin.right,
                height = 660 - margin.top - margin.bottom;

            var svg = d3.select("#total_victims")
            .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
            .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            d3.csv("https://raw.githubusercontent.com/nithinnathan/nithinnathan.github.io/master/total_victims.csv", function(data) {

                var nested_data = d3.nest()
                    .key(function(d) { return d.Location; })
                    .entries(data);

                var x = d3.scaleLinear()
                    .domain(d3.extent(data, function(d) { return d.Year; }))
                    .range([0,width]);

                svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x).ticks(10).tickFormat(d3.format("d")));

                var y = d3.scaleLinear()
                    .domain([0,d3.max(data, function(d) { return +d.Total_Victims; })])
                    .range([height,0]);
                    
                svg.append("g")
                    .call(d3.axisLeft(y).ticks(10));

                svg.selectAll(".line")
                    .data(nested_data)
                    .enter()
                    .append("path")
                        .attr("fill", "none")
                        .attr("stroke", "darkblue")
                        .attr("stroke-dasharray", function(d,i) { return i; })
                        .attr("stroke-width", 2)
                        .attr("d", function(d){
                        return d3.line()
                            .x(function(d) { return x(d.Year); })
                            .y(function(d) { return y(+d.Total_Victims); })
                            (d.values)
                        })
                    .on("mouseover", function (d,i) {
                        tooltip.style("left", d3.event.pageX + "px")
                        .style("top", d3.event.pageY + "px")
                        .style("display", "inline-block")
                        .style("font-family", "Helvetica")
                        .style("font-size", "70%")
                        .html("Sum of Total Victims: 2686");
                        })
                    .on("mouseout", function (d) { tooltip.style("display", "none"); });

                const annotations = [
                {
                    note: {
                        title: "Highest Amount of Total Victims (2017)",
                        wrap: 150
                    },
                    type: d3.annotationLabel,
                    subject: {
                        radius: 10,
                        radiusPadding: 0
                    },
                    color: ["#FF8C00"],
                    x: 512,
                    y: 1,
                    dy: 1,
                    dx: -300
                }];

                const makeAnnotations = d3.annotation().annotations(annotations);
                svg.append("g").call(makeAnnotations);

                var tooltip = d3.select("body").append("div").attr("class", "tooltip");
            })
        </script>
    </body>
</html>